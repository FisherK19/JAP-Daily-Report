<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal</title>
    <link rel="stylesheet" href="/assets/adminportal.css">
</head>
<body>
    <header class="bg-dark text-white text-center p-3">
        <img src="/assets/images/company-logo.png" alt="Company Logo" id="company-logo" class="img-fluid">
        <h1>Admin Portal</h1>
    </header>

    <nav>
        <ul>
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="logout()">Logout</a>
            </li>
        </ul>
    </nav>

    <main class="container mt-4">
        <section id="user-management">
            <h2>User Management</h2>
            <p>View and manage user information.</p>
            <button onclick="fetchUserData()" class="btn btn-primary">View Users</button>
            <table id="user-table" class="table table-striped">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Users will be populated here -->
                </tbody>
            </table>
        </section>
        
        <section id="daily-reports">
            <h2>Daily Reports</h2>
            <p>Access and download daily activity reports.</p>
            <button onclick="downloadReport('pdf')" class="btn btn-secondary">Download All Reports as PDF</button>
            <button onclick="downloadReport('excel')" class="btn btn-secondary">Download All Reports as Excel</button>

            <div>
                <label for="report-date">Select Date:</label>
                <input type="date" id="report-date">
                <button onclick="downloadReportByDate('pdf')" class="btn btn-secondary">Download PDF for Selected Date</button>
                <button onclick="downloadReportByDate('excel')" class="btn btn-secondary">Download Excel for Selected Date</button>
            </div>
        </section>
    </main>

    <footer class="container text-center bg-light p-3 mt-4">
        <p>&copy; 2024 John A. Pappalas Daily Report App. All rights reserved.</p>
    </footer>

    <script src="/assets/js/AdminUser.js"></script>
    <script>
        function logout() {
            fetch('/logout', {
                method: 'POST',
                credentials: 'same-origin'
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/login';
                } else {
                    alert('Logout failed');
                }
            });
        }

        function fetchUserData() {
            fetch('/admin/users/data')
                .then(response => response.json())
                .then(data => {
                    const userTable = document.getElementById('user-table').getElementsByTagName('tbody')[0];
                    userTable.innerHTML = '';

                    data.users.forEach(user => {
                        const row = userTable.insertRow();
                        row.insertCell(0).textContent = user.id;
                        row.insertCell(1).textContent = user.username;
                        row.insertCell(2).textContent = user.email;

                        const actionsCell = row.insertCell(3);
                        const pdfButton = document.createElement('button');
                        pdfButton.textContent = 'PDF';
                        pdfButton.className = 'btn btn-secondary';
                        pdfButton.onclick = () => downloadUserReport(user.id, 'pdf');

                        const excelButton = document.createElement('button');
                        excelButton.textContent = 'Excel';
                        excelButton.className = 'btn btn-secondary';
                        excelButton.onclick = () => downloadUserReport(user.id, 'excel');

                        actionsCell.appendChild(pdfButton);
                        actionsCell.appendChild(excelButton);
                    });
                });
        }

        function downloadReport(format) {
            const url = `/admin/portal/report/${format}`;
            window.location.href = url;
        }

        function downloadReportByDate(format) {
            const date = document.getElementById('report-date').value;
            if (!date) return alert('Please select a date.');

            const url = `/admin/portal/report/${format}/${date}`;
            window.location.href = url;
        }
    </script>
</body>
</html>
