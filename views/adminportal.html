<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal</title>
    <link rel="stylesheet" href="/assets/adminportal.css">
</head>
<body>
    <header>
        <img src="/assets/images/company-logo.png" alt="Company Logo" id="company-logo">
        <h1>Admin Portal</h1>
    </header>

    <nav>
        <ul>
            <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="logout()">Logout</a>
            </li>
        </ul>
    </nav>

    <main class="container mt-4">
        <section id="daily-reports">
            <h2>Daily Reports</h2>
            <p>Access and download daily activity reports.</p>
            <button onclick="downloadReport('pdf')" class="btn btn-secondary">Download All Reports as PDF</button>
            <button onclick="downloadReport('excel')" class="btn btn-secondary">Download All Reports as Excel</button>

            <div>
                <label for="report-date">Select Date:</label>
                <input type="date" id="report-date" onchange="fetchUsersByDate()">
                <label for="user-select">Select User:</label>
                <select id="user-select">
                    <option value="">Select User</option>
                </select>
                <button onclick="downloadUserReport('pdf')" class="btn btn-secondary">Download PDF for Selected User</button>
                <button onclick="downloadUserReport('excel')" class="btn btn-secondary">Download Excel for Selected User</button>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 John A. Pappalas Daily Report App. All rights reserved.</p>
    </footer>

    <script>
        function fetchUsersByDate() {
            const date = document.getElementById('report-date').value;
            if (!date) return;
    
            console.log(`Fetching users for date: ${date}`); // Debug log
    
            fetch(`/admin/portal/users/${date}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(users => {
                    console.log('Users received:', users); // Debug log
    
                    const userSelect = document.getElementById('user-select');
                    userSelect.innerHTML = '<option value="">Select User</option>';
                    if (users.length === 0) {
                        console.log('No users found for the selected date.');
                    } else {
                        users.forEach(user => {
                            if (user.employee && user.employee.trim() !== '') {
                                console.log(`Adding user: ${user.employee}`);
                                const option = document.createElement('option');
                                option.value = user.employee;
                                option.textContent = user.employee;
                                userSelect.appendChild(option);
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching users:', error);
                });
        }
    
        function downloadUserReport(format) {
            const date = document.getElementById('report-date').value;
            const user = document.getElementById('user-select').value;
            if (!date || !user) {
                alert('Please select a date and a user.');
                return;
            }
    
            const url = `/admin/portal/report/${format}/${date}/${user}`;
            window.location.href = url;
        }
    
        function downloadReport(format) {
            const date = document.getElementById('report-date').value;
            if (!date) {
                alert('Please select a date.');
                return;
            }
    
            const url = `/admin/portal/report/all/${format}/${date}`;
            window.location.href = url;
        }
    
        function logout() {
            fetch('/logout', {
                method: 'POST',
                credentials: 'same-origin'
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/adminlogin.html';
                } else {
                    alert('Logout failed');
                }
            });
        }
    </script>
    
    
</body>
</html>





