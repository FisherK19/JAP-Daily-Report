<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Report</title>
    <link rel="stylesheet" href="/assets/daily-report.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header-section">
            <img src="/assets/images/company-logo.png" alt="Company Logo">
            <h1>Daily Report</h1>
        </div>
        <nav class="navbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="logout-link">Logout</a>
                </li>
            </ul>
        </nav>
        <form id="daily-report-form">
            <input type="hidden" name="username" value="user"> 
            <table>
                <tr>
                    <th colspan="4">JOHN A. PAPALAS & COMPANY</th>
                    <th colspan="2">DATE</th>
                    <td colspan="2"><input type="date" name="date" required></td>
                </tr>
                <tr>
                    <th colspan="4">Tel - 313-388-3000 &nbsp; Fax - 313-388-9864</th>
                    <th colspan="2">JOB #</th>
                    <td colspan="2"><input type="text" name="job_number" required></td>
                </tr>
                <tr>
                    <th>FOREMAN:</th>
                    <td colspan="3"><input type="text" name="foreman" required></td>
                    <th>T&M</th>
                    <td><input type="checkbox" name="t_and_m"></td>
                    <th>CONTRACT</th>
                    <td><input type="checkbox" name="contract"></td>
                </tr>
                <tr>
                    <th>Cellular #</th>
                    <td colspan="3"><input type="text" name="cell_number" required></td>
                    <th colspan="2">Job Completion %</th>
                    <td colspan="2"><input type="text" name="job_completion" required></td>
                </tr>
                <tr>
                    <th>CUSTOMER</th>
                    <td colspan="3"><input type="text" name="customer" required></td>
                    <th colspan="2">Shift / Start Time:</th>
                    <td colspan="2"><input type="text" name="shift_start_time" required></td>
                </tr>
                <tr>
                    <th>Customer PO#:</th>
                    <td colspan="7"><input type="text" name="customer_po" required></td>
                </tr>
                <tr>
                    <th>JOB SITE:</th>
                    <td colspan="7"><input type="text" name="job_site" required></td>
                </tr>
                <tr>
                    <th>Job Description:</th>
                    <td colspan="7"><textarea name="job_description" required></textarea></td>
                </tr>
                <tr>
                    <th>SHEETING / MATERIALS:</th>
                    <td colspan="7"><textarea name="materials" required></textarea></td>
                </tr>
            </table>
        
            <div class="employees-section">
                <div class="employee-entry">
                    <div><label>Hours Worked</label><input type="text" name="hours_worked[]"></div>
                    <div><label>EMPLOYEE</label><input type="text" name="employee[]"></div>
                    <div><label>Straight</label><input type="text" name="straight_time[]"></div>
                    <div><label>Time & 1/2</label><input type="text" name="time_and_a_half[]"></div>
                    <div><label>Double Time</label><input type="text" name="double_time[]"></div>
                    <button type="button" class="delete-employee-btn"><i class="fas fa-trash-alt"></i></button>
                </div>
            </div>
            
            <button type="button" id="add-employee-btn">Add Employee</button>
            <table>
                <tr>
                    <th colspan="2">EQUIPMENT:</th>
                </tr>
                <tr>
                    <th>Trucks:</th>
                    <td><input type="text" name="trucks" class="center-input"></td>
                </tr>
                <tr>
                    <th>Welders:</th>
                    <td><input type="text" name="welders" class="center-input"></td>
                </tr>
                <tr>
                    <th>Generators:</th>
                    <td><input type="text" name="generators" class="center-input"></td>
                </tr>
                <tr>
                    <th>Compressors:</th>
                    <td><input type="text" name="compressors" class="center-input"></td>
                </tr>
                <tr>
                    <th>Company Fuel:</th>
                    <td><input type="text" name="fuel" class="center-input"></td>
                </tr>
                <tr>
                    <th>Scaffolding:</th>
                    <td><input type="text" name="scaffolding" class="center-input"></td>
                </tr>
                <tr>
                    <th>Safety Equipment:</th>
                    <td><input type="text" name="safety_equipment" class="center-input"></td>
                </tr>
                <tr>
                    <th>Miscellaneous:</th>
                    <td><input type="text" name="miscellaneous_equipment" class="center-input"></td>
                </tr>
            </table>
            <table>
                <tr>
                    <th colspan="2">MANLIFTS / RENTALS:</th>
                    <td><input type="text" name="manlifts_equipment" class="center-input"></td>
                </tr>
                <tr>
                    <th colspan="2">Fuel:</th>
                    <td><input type="text" name="manlifts_fuel" class="center-input"></td>
                </tr>
                <tr>
                    <th colspan="2">SUB-CONTRACT:</th>
                    <td><textarea name="sub_contract" class="center-input"></textarea></td>
                </tr>
                <tr>
                    <th colspan="2">EMERGENCY PURCHASES:</th>
                    <td><textarea name="emergency_purchases" required class="center-input"></textarea></td>
                </tr>
                <tr>
                    <th colspan="2">DELAY / LOST TIME:</th>
                    <td><textarea name="delay_lost_time" class="center-input"></textarea></td>
                </tr>
                <tr>
                    <th colspan="2">Employees Off:</th>
                    <td><textarea name="employees_off" class="center-input"></textarea></td>
                </tr>
                <tr>
                    <th colspan="2">Temperature/Humidity (if applicable):</th>
                    <td><textarea name="temperature_humidity" class="center-input"></textarea></td>
                </tr>
                <tr>
                    <th colspan="2">Approved By:</th>
                    <td><input type="text" name="approved_by" class="center-input" required></td>
                </tr>
                <tr>
                    <th colspan="2">Report Copy:</th>
                    <td>
                        <select id="report_copy" name="report_copy" required class="center-input">
                            <option value="white">WHITE - J.A.P.</option>
                            <option value="yellow">YELLOW - CUSTOMER</option>
                            <option value="pink">PINK - FOREMAN</option>
                        </select>
                    </td>
                </tr>
            </table>
            <button type="submit">Submit Daily Report</button>
        </form>
    </div>
    <footer>
        <p>&copy; 2024 John A. Papalas Daily Report App. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const reportCopyDropdown = document.getElementById('report_copy');

            if (reportCopyDropdown) {
                function updateDropdownColor() {
                    const selectedValue = reportCopyDropdown.value;
                    reportCopyDropdown.className = ''; 
                    reportCopyDropdown.classList.add(selectedValue); 
                }

                reportCopyDropdown.addEventListener('change', updateDropdownColor);

                // Initialize color on page load
                updateDropdownColor();
            }

            // Add employee entry
            const addEmployeeBtn = document.getElementById('add-employee-btn');
            const employeesSection = document.querySelector('.employees-section');

            if (addEmployeeBtn && employeesSection) {
                addEmployeeBtn.addEventListener('click', function() {
                    const newEmployeeEntry = document.createElement('div');
                    newEmployeeEntry.classList.add('employee-entry');
                    newEmployeeEntry.innerHTML = `
                        <div><label>Hours Worked</label><input type="text" name="hours_worked[]"></div>
                        <div><label>EMPLOYEE</label><input type="text" name="employee[]"></div>
                        <div><label>Straight</label><input type="text" name="straight_time[]"></div>
                        <div><label>Time & 1/2</label><input type="text" name="time_and_a_half[]"></div>
                        <div><label>Double Time</label><input type="text" name="double_time[]"></div>
                        <button type="button" class="delete-employee-btn"><i class="fas fa-trash-alt"></i></button>
                    `;
                    employeesSection.appendChild(newEmployeeEntry);

                    // Add event listener for the new delete button
                    const deleteBtn = newEmployeeEntry.querySelector('.delete-employee-btn');
                    deleteBtn.addEventListener('click', function() {
                        newEmployeeEntry.remove();
                    });
                });
            }

            // Delete employee entry
            document.addEventListener('click', function(event) {
                if (event.target && event.target.classList.contains('delete-employee-btn')) {
                    event.target.closest('.employee-entry').remove();
                }
            });

            // Form submission logic
            const dailyReportForm = document.getElementById('daily-report-form');
            if (dailyReportForm) {
                dailyReportForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    const formData = new FormData(this);
                    const data = Object.fromEntries(formData.entries());

                    // Convert arrays to individual fields
                    data.hours_worked = formData.getAll('hours_worked[]');
                    data.employee = formData.getAll('employee[]');
                    data.straight_time = formData.getAll('straight_time[]');
                    data.time_and_a_half = formData.getAll('time_and_a_half[]');
                    data.double_time = formData.getAll('double_time[]');

                    console.log('Form data:', data); // Log form data
                    fetch('/daily-report', {
                        method: 'POST',
                        body: JSON.stringify(data),
                        headers: { 'Content-Type': 'application/json' }
                    }).then(response => {
                        if (!response.ok) {
                            return response.json().then(err => {
                                throw new Error(err.message);
                            });
                        }
                        return response.json();
                    }).then(data => {
                        alert(data.message);
                    }).catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while submitting the report. Please try again.');
                    });
                });
            }
        });

        // Logout function
        document.getElementById('logout-link').addEventListener('click', function(event) {
            event.preventDefault();
            fetch('/logout', {
                method: 'POST',
                credentials: 'same-origin'
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/login';
                } else {
                    alert('Logout failed');
                }
            }).catch(error => {
                console.error('Logout error:', error);
            });
        });
    </script>
</body>
</html>


